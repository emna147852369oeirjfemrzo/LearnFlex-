{% extends 'back/index.html.twig' %}

{% block title %}Liste des Cours{% endblock %}

{% block dashboard_content %}
<div class="recent-parcels">
    <div class="section-header">
        <h3>Gestion des Cours</h3>
        <a href="{{ path('app_back_cours_new') }}" class="btn primary">
            <i class="fas fa-plus"></i> Ajouter un Cours
        </a>
    </div>

    <!-- Stats and Charts Section -->
    <div class="charts-section" style="margin-bottom: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div class="stat-card" style="padding: 20px; display: flex; align-items: center; gap: 20px;">
            <div class="stat-icon rides" style="background: #f0fdf4; color: #10b981; width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div>
                <h3 style="font-size: 1.8rem; margin: 0;">{{ cours|length }}</h3>
                <p style="margin: 0; color: #64748b;">Total Cours</p>
            </div>
        </div>

        <div class="stat-card" style="padding: 20px; display: flex; align-items: center; gap: 20px;">
            <div class="stat-icon users" style="background: #faf5ff; color: #a855f7; width: 60px; height: 60px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                <i class="fas fa-clock"></i>
            </div>
            <div>
                <h3 style="font-size: 1.8rem; margin: 0;">{{ total_hours }}h</h3>
                <p style="margin: 0; color: #64748b;">Volume Horaire</p>
            </div>
        </div>
    </div>

    <!-- Charts Grid: Two charts side by side -->
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
        <div class="chart-container" style="background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);">
            <h4 style="margin-bottom: 20px; color: var(--secondary);">Volume Horaire par Matière</h4>
            <div style="height: 300px;">
                <canvas id="scoreChart"></canvas>
            </div>
        </div>

        <div class="chart-container" style="background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);">
            <h4 style="margin-bottom: 20px; color: var(--secondary);">Répartition par Langue</h4>
            <div style="height: 300px;">
                <canvas id="langueChart"></canvas>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Volume Horaire Chart (replaces Score Chart)
            const ctxScore = document.getElementById('scoreChart').getContext('2d');
            new Chart(ctxScore, {
                type: 'bar',
                data: {
                    labels: {{ subject_avg_labels|json_encode|raw }},
                    datasets: [{
                        label: 'Volume Horaire (heures)',
                        data: {{ subject_avg_data|json_encode|raw }},
                        backgroundColor: '#10b981',
                        borderRadius: 8,
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { display: false }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });

            // Language Doughnut Chart
            const ctxLang = document.getElementById('langueChart').getContext('2d');
            new Chart(ctxLang, {
                type: 'doughnut',
                data: {
                    labels: {{ langue_labels|json_encode|raw }},
                    datasets: [{
                        data: {{ langue_data|json_encode|raw }},
                        backgroundColor: [
                            '#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        });
    </script>

    <div class="parcels-table-container">
        <style>
            .parcels-table th, .parcels-table td {
                vertical-align: middle !important;
                padding: 12px 15px;
            }
            .parcels-table img {
                display: block;
                margin: 0 auto;
            }
        </style>
        <table class="parcels-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th style="text-align: center;">Image</th>
                    <th>Titre</th>
                    <th>Matière</th>
                    <th>Section</th>
                    <th>Durée</th>
                </tr>
            </thead>
            <tbody>
            {% for cour in pagination %}
                <tr>
                    <td>{{ cour.id }}</td>
                    <td style="text-align: center;">
                        {% if cour.image %}
                            {% if cour.image starts with 'http' %}
                                <img src="{{ cour.image }}" alt="{{ cour.titre }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                            {% else %}
                                <img src="{{ asset('uploads/images/' ~ cour.image) }}" alt="{{ cour.titre }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 4px;">
                            {% endif %}
                        {% else %}
                            <i class="fas fa-image" style="font-size: 24px; color: #ccc;"></i>
                        {% endif %}
                    </td>
                    <td>{{ cour.titre }}</td>
                    <td>{{ cour.matiere ? cour.matiere.nomMatiere : '' }}</td>
                    <td>{{ cour.section }}</td>
                    <td>{{ cour.dureeTotale }}</td>

                </tr>
            {% else %}
                <tr>
                    <td colspan="7">Aucun enregistrement trouvé</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>

        <div class="navigation" style="margin-top: 20px; display: flex; justify-content: center;">
            {{ knp_pagination_render(pagination) }}
        </div>
    </div>
</div>
{% endblock %}
