{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('assets/css/styles.css') }}">
<link rel="stylesheet" href="{{ asset('assets/css/dashboard.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}
 <div class="dashboard">
 
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <img src="{{ asset('assets/images/logo1.png') }}" alt="Learnflex+ Logo" class="nav-logo">
          <span>LearnFlex</span><span class="highlight">+</span>
        </div>
        <button class="sidebar-toggle">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      
      <div class="sidebar-content">
        <nav class="sidebar-menu">
          <ul>
            <li class="active">
              <a href="#">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
             <a href="{{ path('app_users') }}">
                            <i class="fas fa-users"></i>
                            <span>Utilisateurs</span>
                        </a>
            </li>
            <li>
              <a href="#">
                <i class="fas fa-book-open"></i>
                <span>contenu pédagogique</span>
              </a>
            </li>
             <li>
                        <a href="{{ path('app_back_cours_index') }}">
                            <i class="fas fa-book-open"></i>
                            <span>Cours</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ path('app_back_matiere_index') }}">
                            <i class="fas fa-book"></i>
                            <span>Matières</span>
                        </a>
                    </li>
            <li>
              <a href="#">
                <i class="fas fa-graduation-cap"></i>
                <span>Evaluation</span>
              </a>
            </li>
         <li>
  <a href="{{ path('app_quiz_index') }}">
    <i class="fas fa-question-circle"></i>
    <span>Questionnaire</span>
  </a>
</li>

            <li>
              <a href="#">
                <i class="fas fa-directions"></i>
                <span>Orientation</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fas fa-comments"></i>
                <span>Forum</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      
      <div class="sidebar-footer">
        <a href="#" class="user-profile">
          <img src="{{ asset('assets/images/placeholder-admin.png') }}" alt="Admin" class="user-img">
          <div class="user-info">
            <h4>Admin User</h4>
            <p>Administrateur</p>
          </div>
        </a>
        <a href="#" class="logout">
          <i class="fas fa-sign-out-alt"></i>
          <span>Déconnexion</span>
        </a>
      </div>
    </aside>
    
    <main class="main-content">
      <header class="dashboard-header">
        <div class="header-left">
          <h1>Dashboard</h1>
    <p>Bienvenue sur la plateforme d’apprentissage LearnFlex+</p>
        </div>
        <div class="header-right">
           <div class="search-bar" style="display:flex; align-items:center; gap:5px;">
    <form method="get" action="{{ path('app_quiz_index') }}" style="display:flex; align-items:center; gap:5px;">
        <input type="text" 
               name="search" 
               placeholder="Rechercher un quiz..." 
               value="{{ search|default('') }}" 
               style="padding:6px 10px; border-radius:4px; border:1px solid #ccc; min-width:200px;">
        <button type="submit" class="btn btn-primary" style="padding:6px 10px;">
            <i class="fas fa-search"></i>
        </button>
    </form>
</div>
          <button class="notification-btn">
            <i class="fas fa-bell"></i>
            <span class="badge">3</span>
          </button>
        </div>
      </header>
      
      <div class="dashboard-content">

    <!-- Header : titre + recherche + bouton Nouveau Quiz -->
    <div class="section-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        
        <!-- Titre -->
        <h2>Gestion des Quiz</h2>

        <!-- Recherche + bouton Nouveau Quiz -->
        <div style="display:flex; gap:10px; align-items:center;">
            <!-- Formulaire de recherche -->
          

            <!-- Bouton Nouveau Quiz -->
       <!-- Bouton Ajouter un quiz -->
<button id="openQuizModal" class="btn btn-success" 
        style="display:inline-flex; align-items:center; gap:10px; padding:10px 20px; 
               background-color:#77af84; color:white; font-weight:600; border:none; 
               border-radius:4px; cursor:pointer; transition: background 0.2s;">
    <i class="fas fa-plus"></i> Ajouter un quiz
</button>

<style>
#openQuizModal:hover {
    background-color: #7777af; /* vert foncé au survol */
}
</style>



<!-- Bouton Exporter PDF -->
<a href="{{ path('app_quizzes_pdf') }}" target="_blank" class="btn btn-primary" 
   style="display:inline-flex; align-items:center; gap:10px; padding:10px 20px; background-color:#142341; color:white; font-weight:600; border:none; border-radius:4px; text-decoration:none;">
    <i class="fas fa-file-pdf"></i> Exporter PDF
</a>



        </div>
    </div>


    <!-- Tableau des Quiz -->
    <table class="parcels-table" style="width:100%; border-collapse: collapse; background:white; border-radius:8px; overflow:hidden; box-shadow: var(--shadow);">
        <thead style="background: #142341;"> <!-- fond du header -->
            <tr>
            <th style="padding:12px; color: #faf9f6;">
        <a href="{{ path('app_quiz_index', {sortField: 'id', sortDirection: sortField=='id' and sortDirection=='ASC' ? 'DESC' : 'ASC', search: search}) }}" style="color:#faf9f6; text-decoration:none;">
            ID {% if sortField=='id' %}{{ sortDirection=='ASC' ? '⬆️' : '⬇️' }}{% endif %}
        </a>
    </th>
                <th style="padding:12px; color: #faf9f6;">Titre</th>
                <th style="padding:12px; color: #faf9f6;">Description</th>
                <th style="padding:12px; color: #faf9f6;">Durée</th>
                <th style="padding:12px; color: #faf9f6;">Active</th>
                <th style="padding:12px; color: #faf9f6;">Question</th>
                <th style="padding:12px; color: #faf9f6;">Nb réponses</th>
                <th style="padding:12px; color: #faf9f6;">Actions</th>
            </tr>
        </thead>
        <tbody>
        
            {% for quiz in quizzes %}
                <tr style="border-bottom:1px solid var(--border-color);">
                    <td style="padding:12px;">{{ quiz.id }}</td>  {# <- ID #}
                    <td style="padding:12px;">{{ quiz.titre }}</td>
                    <td>{{ quiz.question }}</td>
                    <td>{{ quiz.duree }} min</td>
                    <td>{% if quiz.etat == 'active' %}✅{% else %}❌{% endif %}</td>
                    <td>{{ quiz.question }} </td>
                    <td>{{ quiz.reponses|length }}</td>
                    <td class="actions">
<button
    type="button"
    class="action-btn edit"
    data-id="{{ quiz.id }}"
    data-titre="{{ quiz.titre }}"
    data-question="{{ quiz.question }}"
    data-description="{{ quiz.description }}"
    data-duree="{{ quiz.duree }}"
    data-etat="{{ quiz.etat }}"
>
    <i class="fas fa-edit"></i>
</button>
<a href="{{ path('app_reponse_by_quiz', { id: quiz.id }) }}"
   class="action-btn view"
   title="Voir les réponses">
    <i class="fas fa-list"></i>
</a>

                        <form method="post" action="{{ path('app_quiz_delete', {id: quiz.id}) }}" style="display:inline;">
                            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ quiz.id) }}">
                            <button class="action-btn delete"><i class="fas fa-trash"></i></button>
                        </form>
                        <a href="{{ path('app_quiz_show', {id: quiz.id}) }}" class="action-btn view"><i class="fas fa-eye"></i></a>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="8" style="text-align:center; padding:12px;">Aucun quiz trouvé</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>


</div>

<!-- Overlay et Formulaire Modal -->
<div id="quizModalOverlay" 
     style="display:none; 
            position:fixed; 
            inset:0; 
            background: rgba(0,0,0,0.3); 
            backdrop-filter: blur(6px); 
            -webkit-backdrop-filter: blur(6px);
            z-index:1000; 
            justify-content:center; 
            align-items:center;
            transition: opacity 0.3s ease;">

    <div id="quizModal" 
         style="background:#fff; 
                padding:30px 25px; 
                border-radius:12px; 
                max-width:600px; 
                width:90%; 
                box-shadow:0 10px 25px rgba(0,0,0,0.2);
                position:relative;
                font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                transition: transform 0.3s ease;
                transform: translateY(-20px);">

        <!-- Bouton fermer -->
        <span id="closeQuizModal" 
              style="position:absolute; top:15px; right:20px; font-size:22px; cursor:pointer; color:#555; transition: color 0.2s;">
              &times;
        </span>

        <!-- Titre -->
        <h3 style="margin-bottom:20px; font-size:24px; color:#142341; text-align:center;">Ajouter un nouveau Quiz</h3>

        <!-- Formulaire -->
        {{ form_start(form, {'attr': {'style': 'display:flex; flex-direction:column; gap:15px;'}}) }}

            {{ form_row(form.titre, {'attr': {'style':'padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;'}}) }}
            {{ form_row(form.question, {'attr': {'style':'padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px; resize:vertical; min-height:60px;'}}) }}
            {{ form_row(form.description, {'attr': {'style':'padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px; resize:vertical; min-height:60px;'}}) }}
            {{ form_row(form.duree, {'attr': {'style':'padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;'}}) }}
            {{ form_row(form.etat, {'attr': {'style':'padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;'}}) }}

            <div style="display:flex; justify-content:center; gap:15px; margin-top:10px;">
                <button type="submit" class="btn btn-primary" style="flex:1; padding:10px; border:none; border-radius:6px; background:#142341; color:white; font-weight:600; transition: background 0.2s;">
                    Ajouter
                </button>
                <button type="button" id="cancelQuizModal" class="btn btn-outline" style="flex:1; padding:10px; border:1px solid #ccc; border-radius:6px; background:#f9f9f9; transition: background 0.2s;">
                    Annuler
                </button>
            </div>

        {{ form_end(form) }}
    </div>
</div>

<!-- Modal Modifier Quiz -->
<div id="editQuizModalOverlay" 
     style="display:none; 
            position:fixed; 
            inset:0; 
            background: rgba(0,0,0,0.3); 
            backdrop-filter: blur(6px); 
            -webkit-backdrop-filter: blur(6px);
            z-index:1000; 
            justify-content:center; 
            align-items:center;
            transition: opacity 0.3s ease;">

    <div style="background:#fff; 
                padding:30px 25px; 
                border-radius:12px; 
                width:90%; 
                max-width:600px; 
                position:relative; 
                box-shadow:0 10px 25px rgba(0,0,0,0.2);
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                transition: transform 0.3s ease;
                transform: translateY(-20px);">

        <!-- Bouton fermer -->
        <span id="closeEditQuizModal" 
              style="position:absolute; top:15px; right:20px; font-size:22px; cursor:pointer; color:#555; transition: color 0.2s;">
              &times;
        </span>

        <!-- Titre -->
        <h3 style="margin-bottom:20px; font-size:24px; color:#142341; text-align:center;">Modifier le Quiz</h3>

        <!-- Formulaire -->
        <form id="editQuizForm" method="post" style="display:flex; flex-direction:column; gap:15px;">
            <input type="hidden" name="_token" value="{{ csrf_token('edit_quiz') }}">

            <div style="display:flex; flex-direction:column;">
                <label for="editTitre" style="margin-bottom:5px; font-weight:600;">Titre</label>
                <input type="text" name="quiz[titre]" id="editTitre" class="form-control"
                       style="padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;">
            </div>

            <div style="display:flex; flex-direction:column;">
                <label for="editQuestion" style="margin-bottom:5px; font-weight:600;">Question</label>
                <textarea name="quiz[question]" id="editQuestion" class="form-control" 
                          style="padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px; resize:vertical; min-height:60px;"></textarea>
            </div>

            <div style="display:flex; flex-direction:column;">
                <label for="editDescription" style="margin-bottom:5px; font-weight:600;">Description</label>
                <textarea name="quiz[description]" id="editDescription" class="form-control"
                          style="padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px; resize:vertical; min-height:60px;"></textarea>
            </div>

            <div style="display:flex; flex-direction:column;">
                <label for="editDuree" style="margin-bottom:5px; font-weight:600;">Durée (min)</label>
                <input type="number" name="quiz[duree]" id="editDuree" class="form-control"
                       style="padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;">
            </div>

            <div style="display:flex; flex-direction:column;">
                <label for="editEtat" style="margin-bottom:5px; font-weight:600;">État</label>
                <select name="quiz[etat]" id="editEtat" class="form-control" 
                        style="padding:10px; border-radius:6px; border:1px solid #ccc; font-size:14px;">
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>

            <!-- Boutons -->
            <div style="display:flex; justify-content:center; gap:15px; margin-top:10px;">
                <button class="btn btn-primary" style="flex:1; padding:10px; border:none; border-radius:6px; background:#142341; color:white; font-weight:600; transition: background 0.2s;">
                    Enregistrer
                </button>
                <button type="button" id="cancelEditQuizModal" class="btn btn-outline" 
                        style="flex:1; padding:10px; border:1px solid #ccc; border-radius:6px; background:#f9f9f9; transition: background 0.2s;">
                    Annuler
                </button>
            </div>
        </form>
    </div>
</div>


<script>
    const openBtn = document.getElementById('openQuizModal');
    const overlay = document.getElementById('quizModalOverlay');
    const closeBtn = document.getElementById('closeQuizModal');
    const cancelBtn = document.getElementById('cancelQuizModal');

    // Ouvrir la modal
    openBtn.addEventListener('click', () => {
        overlay.style.display = 'flex';
    });

    // Fermer la modal
    closeBtn.addEventListener('click', () => overlay.style.display = 'none');
    cancelBtn.addEventListener('click', () => overlay.style.display = 'none');

    // Fermer si clic à l'extérieur du formulaire
    overlay.addEventListener('click', (e) => {
        if(e.target === overlay){
            overlay.style.display = 'none';
        }
    });
</script>
<script>
const editButtons = document.querySelectorAll('.action-btn.edit');
const editOverlay = document.getElementById('editQuizModalOverlay');
const editForm = document.getElementById('editQuizForm');

editButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        const id = btn.dataset.id;

        document.getElementById('editTitre').value = btn.dataset.titre;
        document.getElementById('editQuestion').value = btn.dataset.question;
        document.getElementById('editDescription').value = btn.dataset.description;
        document.getElementById('editDuree').value = btn.dataset.duree;
        document.getElementById('editEtat').value = btn.dataset.etat;

        editForm.action = `/quiz/${id}/edit`;

        editOverlay.style.display = 'flex';
    });
});

document.getElementById('closeEditQuizModal').onclick =
document.getElementById('cancelEditQuizModal').onclick = () => {
    editOverlay.style.display = 'none';
};
</script>


{% endblock %}
