{% extends 'front/home.html.twig' %}

{% block title %}{{ challenge.titrec }} | LearnFlex+{% endblock %}
{% block header %}
<header class="landing-header">
    <div class="container">
        <div class="header-left">
            <div class="logo">
                {# Logo clickable for Admin and Enseignant only #}
                {% if app.user and ('ROLE_ADMIN' in app.user.roles or 'ROLE_ENSEIGNANT' in app.user.roles) %}
                    <a href="{{ path('dashboard') }}">
                        <img src="{{ asset('assets/images/logo1.png') }}" alt="LearnFlexPlus Logo" class="main-logo">
                        <span class="logo-text">LearnFlexPlus</span>
                    </a>
                {% else %}
                    <img src="{{ asset('assets/images/logo1.png') }}" alt="LearnFlexPlus Logo" class="main-logo">
                    <span class="logo-text">LearnFlexPlus</span>
                {% endif %}
            </div>
        </div>
        <nav class="main-nav">
            <ul>
                <li class="active"><a href="#">Accueil</a></li>
                <li><a href="#">Contenus p√©dagogiques</a></li>
                <li><a href="{{path('front_evaluation')}}">Evaluation</a></li>
                <li><a href="#">Questionnaire</a></li>
                <li><a href="#">Orientation</a></li>
                <li><a href="#">Forum </a></li>
            </ul>
        </nav>
        
       <div class="header-right">
            {# Dashboard button now optional, you can even remove it if logo is enough #}
            {% if app.user and ('ROLE_ADMIN' in app.user.roles or 'ROLE_ENSEIGNANT' in app.user.roles) %}
                <a href="{{ path('dashboard') }}" class="btn btn-outline dashboard-btn">Dashboard</a>
            {% endif %}

            {# Logout for logged-in users #}
            {% if app.user %}
                <form action="{{ path('app_logout') }}" method="post" style="display:inline;">
                    <button type="submit" class="btn btn-primary logout-btn">D√©connexion</button>
                </form>
            {% else %}
                <a href="{{ path('app_login') }}" class="btn btn-primary">Connexion</a>
            {% endif %}

            <button class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>
</header>
{% endblock %}
{% block body %}

<main class="challenge-ui">

    <!-- HERO -->
    <section class="challenge-hero">
        <div class="hero-overlay"></div>

        <div class="container hero-content">
            <span class="hero-badge">üéØ Challenge</span>
            <h1>{{ challenge.titrec }}</h1>
            <p>{{ challenge.descriptionc }}</p>

            <div class="hero-stats">
                <div class="stat-card">
                    <span>Objectif</span>
                    <strong>{{ challenge.objectifscore }}%</strong>
                </div>
                <div class="stat-card">
                    <span>Progression</span>
                    <strong>{{ challenge.progressionactuelle }}%</strong>
                </div>
                <div class="stat-card">
                    <span>Niveau</span>
                    <strong>{{ challenge.niveauatteint }}</strong>
                </div>
                <div class="stat-card">
                    <span>R√©compense</span>
                    <strong>{{ challenge.typerecomponse }}</strong>
                </div>
            </div>
        </div>
    </section>

    <!-- CONTENU -->
    <section class="challenge-content container">
        {% if challenge.question %}
            <div class="content-card">
                <h3>üß† Activit√© interactive</h3>
                <p class="subtitle">
                    Compl√®te ce challenge pour d√©bloquer l‚Äôexamen associ√© (Interacty)
                </p>

                <div class="interacty-box">
                    <div class="remix-app" data-hash="{{ challenge.question }}">
                        <script src="https://p.interacty.me/l.js" async></script>
                    </div>
                </div>
            </div>
        {% else %}
            <div class="empty-state">
                <p>Aucune activit√© interactive disponible.</p>
            </div>
        {% endif %}
    </section>

 <a href="{{ path('front_examen', {
    'id': challenge.examen.id,
    'niveau': challenge.examen.niveauexamen
}) }}" class="btn btn-primary">
    Passer √† l'examen
</a>


</main>
{% endblock %}

{% block stylesheets %}
<style>
.challenge-ui {
    font-family: 'Poppins', sans-serif;
    background: #f6f8fc;
}

/* HERO */
.challenge-hero {
    position: relative;
    padding: 100px 0;
    background: linear-gradient(135deg, #3fa7d6, #1f4f65); /* Bleu d√©grad√© clair */
    color: #fff;
    overflow: hidden;
    border-bottom-left-radius: 40px;
    border-bottom-right-radius: 40px;
}

.hero-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.08);
}

.hero-content {
    position: relative;
    z-index: 2;
    text-align: center;
}

.hero-badge {
    background: #97c3a2;
    padding: 8px 22px;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 700;
    display: inline-block;
    margin-bottom: 18px;
    color: #fff;
    text-shadow: 0 1px 3px rgba(0,0,0,0.2);
}

.challenge-hero h1 {
    font-size: 3rem;
    margin-bottom: 15px;
    font-weight: 800;
    color: #fff;
    text-shadow: 0 3px 8px rgba(0,0,0,0.25);
    animation: fadeInDown 1s ease forwards;
}

.challenge-hero p {
    max-width: 720px;
    margin: auto;
    opacity: 0.95;
    color: #f0f8ff;
    text-shadow: 0 1px 4px rgba(0,0,0,0.2);
    animation: fadeIn 1.2s ease forwards;
}

/* STATS */
.hero-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 20px;
    margin-top: 45px;
}

.stat-card {
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
    border-radius: 22px;
    padding: 25px;
    text-align: center;
    color: #1f4f65;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(0,0,0,0.15);
}

.stat-card span {
    display: block;
    font-size: 0.85rem;
    color: #555;
}

.stat-card strong {
    font-size: 1.5rem;
    font-weight: 700;
}

/* CONTENT */
.challenge-content {
    margin-top: -60px;
    position: relative;
    z-index: 3;
}

.content-card {
    background: #fff;
    border-radius: 26px;
    padding: 40px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.12);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.content-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 25px 60px rgba(0,0,0,0.15);
}

.content-card h3 {
    font-weight: 700;
    color: #1f4f65;
}

.subtitle {
    color: #555;
    margin-bottom: 30px;
}

.interacty-box {
    border-radius: 20px;
    overflow: hidden;
    border: 1px solid #ddd;
}

/* EMPTY */
.empty-state {
    background: #fff;
    border-radius: 20px;
    padding: 40px;
    text-align: center;
    color: #777;
}

/* FOOTER */
.challenge-footer {
    text-align: center;
    padding: 60px 0;
}

.cta-btn {
    background: linear-gradient(135deg, #97c3a2, #2e6f88);
    color: #fff;
    border: none;
    padding: 16px 55px;
    border-radius: 50px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 15px 45px rgba(46,111,136,0.35);
    transition: all 0.3s ease;
}

.cta-btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 25px 60px rgba(46,111,136,0.45);
    background: linear-gradient(135deg, #2e6f88, #1f4f65);
}

/* ANIMATIONS */
@keyframes fadeInDown {
    0% { opacity: 0; transform: translateY(-20px); }
    100% { opacity: 1; transform: translateY(0); }
}

@keyframes fadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .challenge-hero h1 {
        font-size: 2.2rem;
    }

    .content-card {
        padding: 25px;
    }
}
</style>
{% endblock %}

{% block javascripts %}
<script>
document.getElementById('pass-exam-btn')?.addEventListener('click', function () {
    window.location.href = "/examen/{{ challenge.examen.id }}";
});

/* √âv√©nement Interacty */
window.onInteractyEvent = function(event, payload) {
    if (event === 'ACTION' && payload.actionTypeName === 'QUIZ_COMPLETED') {
        fetch(`/challenge/{{ challenge.id }}/update-score`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-Requested-With': 'XMLHttpRequest',
                'X-CSRF-TOKEN': '{{ csrf_token("update_score_" ~ challenge.id) }}'
            },
            body: JSON.stringify({
                score: 100
            })
        })
        .then(res => res.json())
        .then(data => {
            if (data.status === 'success') {
                window.location.href = "/examen/{{ challenge.examen.id }}";
            }
        });
    }
};
</script>
{% endblock %}
