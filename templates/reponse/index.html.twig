{% extends 'base.html.twig' %}

{% block title %}Dashboard{% endblock %}

{% block stylesheets %}
<link rel="stylesheet" href="{{ asset('assets/css/styles.css') }}">
<link rel="stylesheet" href="{{ asset('assets/css/dashboard.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body %}
 <div class="dashboard">
 
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <img src="{{ asset('assets/images/logo1.png') }}" alt="Learnflex+ Logo" class="nav-logo">
          <span>LearnFlex</span><span class="highlight">+</span>
        </div>
        <button class="sidebar-toggle">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      
      <div class="sidebar-content">
        <nav class="sidebar-menu">
          <ul>
            <li class="active">
              <a href="#">
                <i class="fas fa-tachometer-alt"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fas fa-users"></i>
                <span>Utilisateurs</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fas fa-book-open"></i>
                <span>contenu pédagogique</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fas fa-graduation-cap"></i>
                <span>Evaluation</span>
              </a>
            </li>
         <li>
  <a href="{{ path('app_quiz_index') }}">
    <i class="fas fa-question-circle"></i>
    <span>Questionnaire</span>
  </a>
</li>

            <li>
              <a href="#">
                <i class="fas fa-directions"></i>
                <span>Orientation</span>
              </a>
            </li>
            <li>
              <a href="#">
                <i class="fas fa-comments"></i>
                <span>Forum</span>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      
      <div class="sidebar-footer">
        <a href="#" class="user-profile">
          <img src="{{ asset('assets/images/placeholder-admin.png') }}" alt="Admin" class="user-img">
          <div class="user-info">
            <h4>Admin User</h4>
            <p>Administrateur</p>
          </div>
        </a>
        <a href="#" class="logout">
          <i class="fas fa-sign-out-alt"></i>
          <span>Déconnexion</span>
        </a>
      </div>
    </aside>
    
    <main class="main-content">
      <header class="dashboard-header">
        <div class="header-left">
          <h1>Dashboard</h1>
    <p>Bienvenue sur la plateforme d’apprentissage LearnFlex+</p>
        </div>
        <div class="header-right">
           <div class="search-bar" style="display:flex; align-items:center; gap:5px;">
    <form method="get" action="{{ path('app_quiz_index') }}" style="display:flex; align-items:center; gap:5px;">
        <input type="text" 
               name="search" 
               placeholder="Rechercher un quiz..." 
               value="{{ search|default('') }}" 
               style="padding:6px 10px; border-radius:4px; border:1px solid #ccc; min-width:200px;">
        <button type="submit" class="btn btn-primary" style="padding:6px 10px;">
            <i class="fas fa-search"></i>
        </button>
    </form>
</div>
          <button class="notification-btn">
            <i class="fas fa-bell"></i>
            <span class="badge">3</span>
          </button>
        </div>
      </header>
      
      <div class="dashboard-content">
{# Affichage des flash messages #}
<div id="flash-messages">
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="alert alert-{{ label }}">
                {{ message }}
                <span class="close-btn" onclick="this.parentElement.style.display='none';">&times;</span>
            </div>
        {% endfor %}
    {% endfor %}
</div>

    <!-- Header + bouton Ajouter Réponse -->
    <div class="section-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <div>
            <h2>Gestion des Réponses</h2>
            {% if reponses|length > 0 %}
                <p style="color:#666; margin-top:5px;">
                    <strong>Quiz :</strong> {{ reponses[0].quiz.titre }}
                </p>
            {% endif %}
        </div>
        <!-- Boutons d'action -->
        <div>
            <a href="{{ path('app_quiz_index') }}" class="btn btn-secondary" style="margin-right:10px;">
                <i class="fas fa-arrow-left"></i> Retour aux Quiz
            </a>
     <a href="{{ path('app_reponse_new', {'quizId': quiz.id}) }}" class="btn btn-primary">
    <i class="fas fa-plus"></i> Nouvelle Réponse
</a>


        </div>
    </div>

    <!-- Tableau des Réponses -->
    <table class="parcels-table" style="width:100%; border-collapse: collapse; background:white; border-radius:8px; overflow:hidden; box-shadow: var(--shadow);">
        <thead style="background: #142341; color:#ffffff;">
            <tr>
                <th style="padding:12px;color: #faf9f6;">ID</th>
                <th style="padding:12px;color: #faf9f6;">Texte</th>
                <th style="padding:12px;color: #faf9f6;">Correcte</th>
                <th style="padding:12px;color: #faf9f6;">Actions</th>
            </tr>
        </thead>
        <tbody>
        {% for reponse in reponses %}
            <tr style="border-bottom:1px solid var(--border-color);">
                <td style="padding:12px;">{{ reponse.id }}</td>
                <td style="padding:12px;">{{ reponse.text }}</td>
                <td style="padding:12px; text-align:center;">
                    {% if reponse.estCorrecte %}
                        <span style="color:green; font-size:18px;">✅</span>
                    {% else %}
                        <span style="color:red; font-size:18px;">❌</span>
                    {% endif %}
                </td>
                <td class="actions" style="padding:12px;">
                    <!-- Bouton voir -->
                    <a href="{{ path('app_reponse_show', {'id': reponse.id}) }}" class="action-btn view" title="Voir">
                        <i class="fas fa-eye"></i>
                    </a>

                    <!-- Bouton modifier -->
                    <a href="{{ path('app_reponse_edit', {'id': reponse.id}) }}" class="action-btn edit" title="Modifier">
                        <i class="fas fa-edit"></i>
                    </a>

                    <!-- Bouton supprimer -->
                  <form method="post" action="{{ path('app_reponse_delete', {'id': reponse.id}) }}" style="display:inline;" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette réponse ?');">
    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ reponse.id) }}">
    <button class="action-btn delete" title="Supprimer" type="submit">
        <i class="fas fa-trash"></i>
    </button>
</form>


                </td>
            </tr>
        {% else %}
            <tr>
                <td colspan="4" style="text-align:center; padding:20px; color:#999;">
                    <i class="fas fa-inbox" style="font-size:48px; margin-bottom:10px; display:block;"></i>
                    Aucune réponse trouvée pour ce quiz
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ label }}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}

</div>

<!-- CSS pour harmoniser les boutons -->
<style>
.action-btn {
    display: inline-flex;
    justify-content: center;
    align-items: center;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    color: white;
    font-size: 14px;
    margin-right: 5px;
    transition: all 0.3s ease;
}

.action-btn.edit { background: #ffdba2; }
.action-btn.delete { background: #f8c5ca; }
.action-btn.view { background: #b4bbff; }
.action-btn:hover { 
    opacity: 0.8;
    transform: scale(1.1);
}

.btn-secondary {
    background: #6c757d;
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    text-decoration: none;
    display: inline-block;
}

.btn-secondary:hover {
    background: #5a6268;
}
#flash-messages {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 2000;
}

.alert {
    padding: 12px 20px;
    margin-bottom: 10px;
    border-radius: 5px;
    font-weight: 500;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    min-width: 250px;
    position: relative;
    animation: slideIn 0.5s ease;
}

/* Alert types */
.alert-success { background-color: #d4edda; color: #155724; }
.alert-error   { background-color: #f8d7da; color: #721c24; }

/* Bouton fermer */
.alert .close-btn {
    position: absolute;
    top: 5px;
    right: 10px;
    cursor: pointer;
    font-weight: bold;
}

/* Animation d'entrée */
@keyframes slideIn {
    from { opacity: 0; transform: translateX(50px); }
    to   { opacity: 1; transform: translateX(0); }
}

</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const alerts = document.querySelectorAll('#flash-messages .alert');
    alerts.forEach(alert => {
        setTimeout(() => {
            alert.style.display = 'none';
        }, 3000); // disparaît après 3 secondes
    });
});
</script>


{% endblock %}
